---
phase: 37-skeleton-check-plumbing
plan: 03
type: execute
wave: 2
depends_on: [01]
files_modified:
  - src/booty/github/comments.py
  - tests/test_github_comments.py
autonomous: true

must_haves:
  truths:
    - "post_reviewer_comment finds existing comment with <!-- booty-reviewer --> and edits it"
    - "If no matching comment, creates new"
    - "Single Reviewer comment per PR (upsert semantics)"
  artifacts:
    - path: src/booty/github/comments.py
      provides: post_reviewer_comment
  key_links:
    - from: post_reviewer_comment
      to: issue.get_comments()
      via: iterate, find marker, edit or create
---

<objective>
Add post_reviewer_comment to github/comments.py for single PR comment upsert with <!-- booty-reviewer --> marker (REV-10).

Purpose: Find-and-edit pattern like post_memory_comment; keeps one Reviewer comment per PR.
Output: post_reviewer_comment in comments.py; tests.
</objective>

<execution_context>
@/Users/marlinf/.claude/get-shit-done/workflows/execute-plan.md
@/Users/marlinf/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/37-skeleton-check-plumbing/37-RESEARCH.md
@.planning/phases/37-skeleton-check-plumbing/37-CONTEXT.md
@src/booty/github/comments.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: post_reviewer_comment</name>
  <files>src/booty/github/comments.py</files>
  <action>
Add post_reviewer_comment to comments.py, mirroring post_memory_comment:

Signature:
```python
def post_reviewer_comment(
    github_token: str,
    repo_url: str,
    pr_number: int,
    body: str,
) -> None:
```

- body MUST include the full content including <!-- booty-reviewer --> ... <!-- /booty-reviewer --> block (caller provides formatted body)
- Use _get_repo, repo.get_issue(pr_number) — same as post_memory_comment (PRs share number with issues)
- Iterate issue.get_comments(); if "<!-- booty-reviewer -->" in comment.body -> comment.edit(body); return
- Else: issue.create_comment(body)
- Log: reviewer_comment_updated / reviewer_comment_posted
- Raises GithubException on failure (mirror other comment functions)
- CONTEXT: Place block near top after heading; caller formats. No specific layout in this function — accept body as-is.
  </action>
  <verify>python -c "from booty.github.comments import post_reviewer_comment; print(post_reviewer_comment.__name__)"</verify>
  <done>post_reviewer_comment exists; find-and-edit semantics</done>
</task>

<task type="auto">
  <name>Task 2: Tests for post_reviewer_comment</name>
  <files>tests/test_github_comments.py</files>
  <action>
Add tests to tests/test_github_comments.py:

1. test_post_reviewer_comment_edits_existing: Mock issue with one comment containing "<!-- booty-reviewer -->"; call post_reviewer_comment; assert comment.edit called, create_comment NOT called
2. test_post_reviewer_comment_creates_when_no_match: Mock issue.get_comments() to return comments without marker; call post_reviewer_comment; assert issue.create_comment called with body containing marker
3. test_post_reviewer_comment_body_includes_marker: Document that caller must include <!-- booty-reviewer --> in body for find-and-edit to work (or test that body is passed through)

Mirror test patterns from post_memory_comment / post_plan_comment tests.
  </action>
  <verify>pytest tests/test_github_comments.py -v -k reviewer</verify>
  <done>post_reviewer_comment tests pass</done>
</task>

</tasks>

<verification>
- pytest tests/test_github_comments.py passes
- post_reviewer_comment edits when marker found, creates when not
- Body passed through as-is; caller responsible for marker inclusion
</verification>

<success_criteria>
- [ ] post_reviewer_comment in comments.py
- [ ] Find-and-edit with <!-- booty-reviewer --> marker
- [ ] Tests pass
</success_criteria>

<output>
After completion, create .planning/phases/37-skeleton-check-plumbing/37-03-SUMMARY.md
</output>
