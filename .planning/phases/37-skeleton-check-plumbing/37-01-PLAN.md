---
phase: 37-skeleton-check-plumbing
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/booty/reviewer/__init__.py
  - src/booty/reviewer/config.py
  - src/booty/test_runner/config.py
  - tests/test_reviewer_config.py
autonomous: true

must_haves:
  truths:
    - "ReviewerConfig schema validates enabled and block_on"
    - "Unknown keys in reviewer block raise ReviewerConfigError (not BootyConfig load failure)"
    - "REVIEWER_ENABLED env overrides file config"
    - "Missing reviewer block yields disabled (get_reviewer_config returns None)"
  artifacts:
    - path: src/booty/reviewer/__init__.py
      provides: reviewer module exports
    - path: src/booty/reviewer/config.py
      provides: ReviewerConfig, get_reviewer_config, apply_reviewer_env_overrides
    - path: src/booty/test_runner/config.py
      provides: BootyConfigV1.reviewer field
  key_links:
    - from: get_reviewer_config
      to: BootyConfigV1.reviewer
      via: getattr(booty_config, "reviewer", None)
---

<objective>
Create Reviewer module skeleton and ReviewerConfig schema with unknown-key isolation and env overrides.

Purpose: REV-12, REV-13 — .booty.yml reviewer block (enabled, block_on); missing block => disabled; unknown keys fail Reviewer only; REVIEWER_ENABLED env wins.
Output: src/booty/reviewer/ with config.py; BootyConfigV1.reviewer field; tests.
</objective>

<execution_context>
@/Users/marlinf/.claude/get-shit-done/workflows/execute-plan.md
@/Users/marlinf/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/37-skeleton-check-plumbing/37-RESEARCH.md
@.planning/phases/37-skeleton-check-plumbing/37-CONTEXT.md
@src/booty/architect/config.py
@src/booty/test_runner/config.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Reviewer module skeleton and ReviewerConfig</name>
  <files>src/booty/reviewer/__init__.py, src/booty/reviewer/config.py</files>
  <action>
Create src/booty/reviewer/ directory and files:

1. **config.py:**
   - ReviewerConfigError(Exception) — raised when reviewer block has unknown keys. Message: "Invalid reviewer config in .booty.yml: {e!s}"
   - ReviewerConfig(BaseModel): model_config extra="forbid", enabled: bool = False, block_on: list[str] = Field(default_factory=list). block_on valid values: overengineering, poor_tests, duplication, architectural_regression (validate or allow any string for extensibility — REV-12 lists these; use Literal or allow list[str] for Phase 39 mapping)
   - get_reviewer_config(booty_config) -> ReviewerConfig | None: getattr(booty_config, "reviewer", None); if None or not dict return None; try ReviewerConfig.model_validate(reviewer); except ValidationError raise ReviewerConfigError
   - apply_reviewer_env_overrides(config: ReviewerConfig) -> ReviewerConfig: os.environ.get("REVIEWER_ENABLED"); if "1"/"true"/"yes" -> enabled=True; if "0"/"false"/"no" -> enabled=False; else return config unchanged. Mirror apply_architect_env_overrides.

2. **__init__.py:**
   - Export: ReviewerConfig, ReviewerConfigError, get_reviewer_config, apply_reviewer_env_overrides
  </action>
  <verify>python -c "from booty.reviewer import get_reviewer_config, ReviewerConfig; print('OK')"</verify>
  <done>ReviewerConfig and get_reviewer_config importable; unknown keys raise ReviewerConfigError</done>
</task>

<task type="auto">
  <name>Task 2: BootyConfigV1.reviewer field</name>
  <files>src/booty/test_runner/config.py</files>
  <action>
Add reviewer field to BootyConfigV1 in test_runner/config.py:

1. reviewer: dict | None = Field(default=None, description="Optional reviewer config; raw dict, validated by get_reviewer_config")
2. Add field_validator("reviewer", mode="before") that keeps as dict | None (like architect). Do NOT validate here — validation at get_reviewer_config only. Unknown keys must NOT fail BootyConfigV1 load.

Mirror the architect field pattern: raw dict, no ValidationError at parse time.
  </action>
  <verify>python -c "from booty.test_runner.config import load_booty_config_from_content; c=load_booty_config_from_content('schema_version: 1\ntest_command: pytest\nreviewer:\n  enabled: true\n  typo: bad'); assert hasattr(c, 'reviewer'); assert c.reviewer == {'enabled': True, 'typo': 'bad'}"</verify>
  <done>BootyConfigV1 loads with reviewer block containing unknown keys; reviewer is raw dict</done>
</task>

<task type="auto">
  <name>Task 3: Tests for ReviewerConfig</name>
  <files>tests/test_reviewer_config.py</files>
  <action>
Create tests/test_reviewer_config.py:

1. test_get_reviewer_config_returns_none_when_absent: booty_config has no reviewer attr -> None
2. test_get_reviewer_config_valid: reviewer dict with enabled, block_on -> ReviewerConfig
3. test_get_reviewer_config_unknown_key_raises: reviewer dict with unknown key -> ReviewerConfigError
4. test_apply_reviewer_env_overrides: REVIEWER_ENABLED=1 -> enabled True; REVIEWER_ENABLED=0 -> enabled False; unset -> unchanged
5. test_missing_block_disabled: get_reviewer_config returns None when reviewer absent -> caller treats as disabled
  </action>
  <verify>pytest tests/test_reviewer_config.py -v</verify>
  <done>All ReviewerConfig tests pass</done>
</task>

</tasks>

<verification>
- pytest tests/test_reviewer_config.py passes
- BootyConfigV1 with reviewer block containing unknown key loads successfully (reviewer is raw dict)
- get_reviewer_config on that config raises ReviewerConfigError (validation at read time, not load time)
</verification>

<success_criteria>
- [ ] reviewer/ module exists with config.py and __init__.py
- [ ] ReviewerConfig, get_reviewer_config, apply_reviewer_env_overrides work
- [ ] BootyConfigV1.reviewer raw dict; unknown keys fail get_reviewer_config only
- [ ] REVIEWER_ENABLED env override works
</success_criteria>

<output>
After completion, create .planning/phases/37-skeleton-check-plumbing/37-01-SUMMARY.md
</output>
