---
phase: 02-llm-code-generation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - pyproject.toml
  - src/booty/config.py
  - src/booty/llm/__init__.py
  - src/booty/llm/models.py
autonomous: true

must_haves:
  truths:
    - "New dependencies (magentic, PyGithub, anthropic, pathspec) are installed and importable"
    - "Config has all Phase 2 settings (ANTHROPIC_API_KEY, LLM_MAX_TOKENS, LLM_MAX_CONTEXT_TOKENS, MAX_FILES_PER_ISSUE, RESTRICTED_PATHS)"
    - "Pydantic models define structured contracts for issue analysis and code generation output"
  artifacts:
    - path: "pyproject.toml"
      provides: "Phase 2 dependencies"
      contains: "magentic"
    - path: "src/booty/config.py"
      provides: "Extended settings with LLM and security config"
      contains: "ANTHROPIC_API_KEY"
    - path: "src/booty/llm/models.py"
      provides: "IssueAnalysis, FileChange, CodeGenerationPlan Pydantic models"
      exports: ["IssueAnalysis", "FileChange", "CodeGenerationPlan"]
  key_links:
    - from: "src/booty/llm/models.py"
      to: "pydantic"
      via: "BaseModel inheritance"
      pattern: "class.*BaseModel"
---

<objective>
Install Phase 2 dependencies, extend configuration with LLM/security settings, and create Pydantic models that define the structured contracts for all LLM interactions.

Purpose: Everything in Phase 2 imports these models and settings. This is the shared foundation.
Output: Installable deps, extended config, and type-safe LLM I/O models.
</objective>

<execution_context>
@/Users/marlinf/.claude/get-shit-done/workflows/execute-plan.md
@/Users/marlinf/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-llm-code-generation/02-RESEARCH.md
@src/booty/config.py
@pyproject.toml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Phase 2 dependencies and extend config</name>
  <files>pyproject.toml, src/booty/config.py</files>
  <action>
  1. Add to pyproject.toml dependencies:
     - "magentic[anthropic]"
     - "PyGithub"
     - "anthropic"
     - "pathspec"

  2. Run `pip install -e ".[dev]"` to install new deps.

  3. Extend Settings class in src/booty/config.py with new fields:
     - ANTHROPIC_API_KEY: str (required, no default)
     - LLM_MAX_TOKENS: int = 4096 (max output tokens for generation)
     - LLM_MAX_CONTEXT_TOKENS: int = 180000 (context window budget, conservative buffer)
     - MAX_FILES_PER_ISSUE: int = 10 (file count cap)
     - RESTRICTED_PATHS: str = ".github/workflows/**,.env,.env.*,**/*.env,**/secrets.*,Dockerfile,docker-compose*.yml,*lock.json,*.lock" (comma-separated denylist patterns)

  Keep all existing Phase 1 settings unchanged. Add new settings AFTER the existing ones with a comment section "# Phase 2: LLM Code Generation".
  </action>
  <verify>
  Run: `python -c "from booty.config import Settings; print('OK')"`
  Run: `python -c "import magentic; import github; import anthropic; import pathspec; print('OK')"`
  </verify>
  <done>All four new dependencies importable. Settings class has 5 new fields with correct types and defaults.</done>
</task>

<task type="auto">
  <name>Task 2: Create Pydantic models for LLM structured outputs</name>
  <files>src/booty/llm/__init__.py, src/booty/llm/models.py</files>
  <action>
  1. Create src/booty/llm/__init__.py (empty, just makes it a package).

  2. Create src/booty/llm/models.py with these Pydantic models:

  **IssueAnalysis** - Output of issue analysis LLM call:
  - task_description: str (Field: "Clear description of what needs to be done")
  - files_to_modify: list[str] (Field: "Existing files requiring changes")
  - files_to_create: list[str] (Field: "New files to create")
  - files_to_delete: list[str] (Field: "Files to remove", default_factory=list)
  - acceptance_criteria: list[str] (Field: "How to verify the changes are correct")
  - commit_type: str (Field: "Conventional commit type: feat, fix, refactor, docs, test, chore")
  - commit_scope: str | None (Field: "Optional commit scope", default=None)
  - summary: str (Field: "One-line summary for PR title")

  **FileChange** - Single file modification from code generation:
  - path: str (Field: "File path relative to workspace root")
  - content: str (Field: "Complete file content")
  - operation: Literal["create", "modify", "delete"] (Field: "Type of file operation")
  - explanation: str (Field: "Brief explanation of what changed and why")

  **CodeGenerationPlan** - Planning step before generation:
  - changes: list[FileChange] (Field: "All file changes to apply")
  - approach: str (Field: "High-level description of the approach taken")
  - testing_notes: str (Field: "Notes on how to test these changes")

  All models should inherit from pydantic.BaseModel with Field descriptions.
  Import Literal from typing.
  </action>
  <verify>
  Run: `python -c "from booty.llm.models import IssueAnalysis, FileChange, CodeGenerationPlan; print('OK')"`
  Run: `python -c "from booty.llm.models import FileChange; fc = FileChange(path='test.py', content='x=1', operation='create', explanation='test'); print(fc.model_dump())"`
  </verify>
  <done>Three Pydantic models importable and instantiable with correct field types, defaults, and descriptions.</done>
</task>

</tasks>

<verification>
- [ ] `pip install -e ".[dev]"` succeeds
- [ ] `python -c "import magentic, github, anthropic, pathspec"` succeeds
- [ ] Settings class has ANTHROPIC_API_KEY, LLM_MAX_TOKENS, LLM_MAX_CONTEXT_TOKENS, MAX_FILES_PER_ISSUE, RESTRICTED_PATHS
- [ ] IssueAnalysis, FileChange, CodeGenerationPlan all importable from booty.llm.models
- [ ] Models validate correctly (reject bad types, accept good data)
</verification>

<success_criteria>
Phase 2 foundation in place: dependencies installed, config extended, structured LLM output models defined. All downstream plans can import these.
</success_criteria>

<output>
After completion, create `.planning/phases/02-llm-code-generation/02-01-SUMMARY.md`
</output>
