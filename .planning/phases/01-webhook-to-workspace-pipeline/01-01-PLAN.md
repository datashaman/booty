---
phase: 01-webhook-to-workspace-pipeline
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - pyproject.toml
  - src/booty/__init__.py
  - src/booty/config.py
  - src/booty/logging.py
autonomous: true

must_haves:
  truths:
    - "Application has installable Python package with all dependencies declared"
    - "Configuration loads from environment variables with validated defaults"
    - "All log output is structured JSON with correlation ID support"
  artifacts:
    - path: "pyproject.toml"
      provides: "Package metadata and dependencies"
      contains: "fastapi"
    - path: "src/booty/config.py"
      provides: "Pydantic Settings configuration"
      exports: ["Settings", "settings"]
    - path: "src/booty/logging.py"
      provides: "structlog configuration with correlation IDs"
      exports: ["configure_logging", "get_logger"]
  key_links:
    - from: "src/booty/config.py"
      to: "environment variables"
      via: "pydantic-settings BaseSettings"
      pattern: "class Settings.*BaseSettings"
    - from: "src/booty/logging.py"
      to: "structlog"
      via: "JSONRenderer processor pipeline"
      pattern: "JSONRenderer"
---

<objective>
Set up the Python project skeleton with dependency management, environment-based configuration, and structured JSON logging.

Purpose: Every other component depends on configuration and logging. This must exist first.
Output: Installable Python package with Pydantic Settings config and structlog JSON logging.
</objective>

<execution_context>
@/Users/marlinf/.claude/get-shit-done/workflows/execute-plan.md
@/Users/marlinf/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-webhook-to-workspace-pipeline/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create project skeleton with dependencies</name>
  <files>pyproject.toml, src/booty/__init__.py</files>
  <action>
Create `pyproject.toml` with:
- Project name: `booty`
- Python requires: `>=3.11`
- Dependencies: `fastapi[standard]`, `pydantic-settings`, `gitpython`, `structlog`, `asgi-correlation-id`, `uvicorn`
- Dev dependencies group: `pytest`, `pytest-asyncio`, `httpx` (for FastAPI test client)
- Build system: setuptools with `src` layout
- Entry point script: `booty = "booty.main:app"` (placeholder for uvicorn)

Create `src/booty/__init__.py` as empty package init.

Do NOT add magentic yet (Phase 2 dependency).
  </action>
  <verify>
Run `pip install -e ".[dev]"` and verify it installs successfully.
Run `python -c "import booty"` and verify no import errors.
  </verify>
  <done>Package installs cleanly with all Phase 1 dependencies available for import.</done>
</task>

<task type="auto">
  <name>Task 2: Configuration store and structured logging</name>
  <files>src/booty/config.py, src/booty/logging.py</files>
  <action>
Create `src/booty/config.py`:
- Class `Settings(BaseSettings)` with fields:
  - `WEBHOOK_SECRET: str` (required, no default)
  - `TARGET_REPO_URL: str` (required, no default)
  - `TARGET_BRANCH: str = "main"`
  - `TRIGGER_LABEL: str = "agent:builder"`
  - `GITHUB_TOKEN: str = ""` (optional, for private repos)
  - `LLM_TEMPERATURE: float = 0.0` (REQ-17 deterministic default)
  - `LLM_MODEL: str = "claude-sonnet-4"` (REQ-17)
  - `LLM_TIMEOUT: int = 300`
  - `MAX_RETRY_ATTEMPTS: int = 3`
  - `WORKER_COUNT: int = 3`
  - `QUEUE_MAX_SIZE: int = 100`
  - `LOG_LEVEL: str = "INFO"`
- Use `SettingsConfigDict(env_file=".env", env_file_encoding="utf-8", case_sensitive=True)`
- Export module-level `settings` instance created lazily via function `get_settings()` to allow test overrides
- Use `from functools import lru_cache` for settings caching

Create `src/booty/logging.py`:
- Function `configure_logging(log_level: str = "INFO")` that calls `structlog.configure()` with processors:
  - `structlog.contextvars.merge_contextvars` (for correlation IDs)
  - `structlog.stdlib.filter_by_level`
  - `structlog.processors.TimeStamper(fmt="iso")`
  - `structlog.stdlib.add_logger_name`
  - `structlog.stdlib.add_log_level`
  - `structlog.processors.StackInfoRenderer()`
  - `structlog.processors.format_exc_info`
  - `structlog.processors.JSONRenderer()`
- Set `logger_factory=structlog.stdlib.LoggerFactory()` and `cache_logger_on_first_use=True`
- Also configure stdlib logging root logger to WARNING to suppress noisy library logs
- Function `get_logger()` that returns `structlog.get_logger()`

IMPORTANT: Python imports must be at the top of each file.
  </action>
  <verify>
Run:
```
WEBHOOK_SECRET=test TARGET_REPO_URL=https://github.com/test/repo python -c "
from booty.config import get_settings
s = get_settings()
assert s.TARGET_BRANCH == 'main'
assert s.LLM_TEMPERATURE == 0.0
assert s.TRIGGER_LABEL == 'agent:builder'
print('Config OK')
"
```

Run:
```
python -c "
from booty.logging import configure_logging, get_logger
configure_logging()
logger = get_logger()
logger.info('test_event', key='value')
print('Logging OK')
"
```
Verify the log output is JSON with timestamp, level, and event fields.
  </verify>
  <done>Settings load from environment with correct defaults. Logging produces JSON output with all required fields. Both modules importable.</done>
</task>

</tasks>

<verification>
1. `pip install -e ".[dev]"` succeeds
2. `python -c "from booty.config import get_settings; from booty.logging import configure_logging"` succeeds
3. Settings validated: required fields raise error when missing, defaults are correct
4. Log output is valid JSON with timestamp, level, event name
</verification>

<success_criteria>
- Python package is installable with all Phase 1 dependencies
- Configuration loads from environment variables with Pydantic validation
- Structured logging outputs JSON with correlation ID support
- Both modules are importable and functional
</success_criteria>

<output>
After completion, create `.planning/phases/01-webhook-to-workspace-pipeline/01-01-SUMMARY.md`
</output>
