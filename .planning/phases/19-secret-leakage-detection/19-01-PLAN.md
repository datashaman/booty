---
phase: 19-secret-leakage-detection
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/booty/test_runner/config.py
  - tests/test_security_config.py
autonomous: true

must_haves:
  truths:
    - "Security block accepts secret_scanner and secret_scan_exclude"
    - "secret_scanner defaults to gitleaks, accepts trufflehog"
    - "secret_scan_exclude is optional list of path patterns"
    - "Unknown keys still fail config (extra='forbid')"
  artifacts:
    - path: src/booty/test_runner/config.py
      provides: SecurityConfig with secret_scanner, secret_scan_exclude
      contains: "secret_scanner"
    - path: tests/test_security_config.py
      provides: Tests for new SecurityConfig fields
      contains: "secret_scanner"
  key_links:
    - from: SecurityConfig
      to: apply_security_env_overrides
      via: Config load path
      pattern: "apply_security_env_overrides"
---

<objective>
Extend SecurityConfig with secret_scanner and secret_scan_exclude for Phase 19 secret scanning.

Purpose: Repo-configurable scanner choice (gitleaks vs trufflehog) and path exclusions.
Output: SecurityConfig.secret_scanner, SecurityConfig.secret_scan_exclude; tests.
</objective>

<execution_context>
@/Users/marlinf/.claude/get-shit-done/workflows/execute-plan.md
@/Users/marlinf/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/19-secret-leakage-detection/19-CONTEXT.md
@.planning/phases/19-secret-leakage-detection/19-RESEARCH.md
@src/booty/test_runner/config.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add secret_scanner and secret_scan_exclude to SecurityConfig</name>
  <files>src/booty/test_runner/config.py</files>
  <action>
Add two optional fields to SecurityConfig (after sensitive_paths):

1. secret_scanner: Literal["gitleaks", "trufflehog"] = "gitleaks"
   - Configurable scanner tool. Default gitleaks per CONTEXT.

2. secret_scan_exclude: list[str] = Field(default_factory=list, description="Path patterns to exclude from secret scan (e.g. test fixtures)")

Preserve model_config extra="forbid". No env overrides for these (per CONTEXT: configurable per repo only).
  </action>
  <verify>python -c "
from booty.test_runner.config import SecurityConfig
c = SecurityConfig()
assert c.secret_scanner == 'gitleaks'
assert c.secret_scan_exclude == []
c2 = SecurityConfig(secret_scanner='trufflehog', secret_scan_exclude=['tests/fixtures/**'])
assert c2.secret_scanner == 'trufflehog'
assert 'tests/fixtures/**' in c2.secret_scan_exclude
print('OK')
"</verify>
  <done>SecurityConfig has secret_scanner (default gitleaks) and secret_scan_exclude (default []).</done>
</task>

<task type="auto">
  <name>Task 2: Add tests for secret_scanner and secret_scan_exclude</name>
  <files>tests/test_security_config.py</files>
  <action>
Add tests:
1. Default values: secret_scanner="gitleaks", secret_scan_exclude=[]
2. Custom secret_scanner="trufflehog" parses correctly
3. secret_scan_exclude with paths parses correctly
4. Invalid secret_scanner value raises (if applicable) or document valid values
5. Unknown key in security block still fails (extra='forbid') â€” may already exist, ensure covered
  </action>
  <verify>pytest tests/test_security_config.py -v -k "secret"</verify>
  <done>Tests pass for new SecurityConfig fields.</done>
</task>

</tasks>

<verification>
- SecurityConfig schema loads with secret_scanner and secret_scan_exclude
- apply_security_env_overrides does not need changes (new fields are repo-only)
- Existing SecurityConfig tests still pass
</verification>

<success_criteria>
- SecurityConfig accepts secret_scanner and secret_scan_exclude
- Defaults: gitleaks, []
- extra='forbid' preserved
- Tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/19-secret-leakage-detection/19-01-SUMMARY.md`
</output>
