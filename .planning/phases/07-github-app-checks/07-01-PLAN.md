---
phase: 07-github-app-checks
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/booty/config.py
  - src/booty/main.py
autonomous: true

must_haves:
  truths:
    - "Verifier is disabled when GITHUB_APP_ID or GITHUB_APP_PRIVATE_KEY is empty"
    - "Startup logs 'Verifier: disabled' when credentials missing"
    - "Settings accept optional App credentials without failing validation"
  artifacts:
    - path: src/booty/config.py
      provides: GITHUB_APP_ID, GITHUB_APP_PRIVATE_KEY, verifier_enabled check
      min_lines: 55
  key_links:
    - from: config.py
      to: Settings
      via: GITHUB_APP_ID, GITHUB_APP_PRIVATE_KEY fields
      pattern: GITHUB_APP
---

<objective>
Add GitHub App credentials to Settings and verifier-enabled detection. When empty, Verifier is disabled; startup logs explicitly.

Purpose: VERIFY-01 foundation — Checks API requires App auth; optional config allows running Booty without Verifier.
Output: config.py with GITHUB_APP_ID, GITHUB_APP_PRIVATE_KEY (optional), verifier_enabled helper; startup log.
</objective>

<execution_context>
@/Users/marlinf/.claude/get-shit-done/workflows/execute-plan.md
@/Users/marlinf/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-github-app-checks/07-RESEARCH.md
@.planning/phases/07-github-app-checks/07-CONTEXT.md
@src/booty/config.py
@src/booty/main.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add GITHUB_APP_ID and GITHUB_APP_PRIVATE_KEY to Settings</name>
  <files>src/booty/config.py</files>
  <action>
Extend src/booty/config.py Settings class:

1. Add fields (optional, empty string when not set):
   - GITHUB_APP_ID: str = ""
   - GITHUB_APP_PRIVATE_KEY: str = ""

2. Both default to "" so Booty runs without Verifier when not configured.

3. Use SettingsConfigDict extra="ignore" (already present) so unknown env vars are ignored.

4. Add module-level helper:
   def verifier_enabled(settings: Settings) -> bool:
       """Return True if GitHub App credentials are configured for Verifier."""
       return bool(settings.GITHUB_APP_ID and settings.GITHUB_APP_PRIVATE_KEY)

5. PEM normalization: GITHUB_APP_PRIVATE_KEY may contain literal "\n" in env. The checks module will normalize (replace "\\n" with "\n") when using it; no validator needed in Settings.
</action>
  <verify>
cd /Users/marlinf/Projects/datashaman/booty && python -c "
from booty.config import get_settings, Settings
# Without env vars, should have empty strings
s = get_settings()
assert hasattr(s, 'GITHUB_APP_ID')
assert hasattr(s, 'GITHUB_APP_PRIVATE_KEY')
assert s.GITHUB_APP_ID == '' or isinstance(s.GITHUB_APP_ID, str)
assert s.GITHUB_APP_PRIVATE_KEY == '' or isinstance(s.GITHUB_APP_PRIVATE_KEY, str)
from booty.config import verifier_enabled
assert callable(verifier_enabled)
# When empty, verifier disabled
from unittest.mock import MagicMock
m = MagicMock()
m.GITHUB_APP_ID = ''
m.GITHUB_APP_PRIVATE_KEY = ''
assert verifier_enabled(m) == False
m.GITHUB_APP_ID = '123'
m.GITHUB_APP_PRIVATE_KEY = 'key'
assert verifier_enabled(m) == True
print('OK: Settings extended, verifier_enabled works')
"
  </verify>
  <done>GITHUB_APP_ID, GITHUB_APP_PRIVATE_KEY in Settings; verifier_enabled() helper.</done>
</task>

<task type="auto">
  <name>Task 2: Add Verifier disabled startup log in main.py</name>
  <files>src/booty/main.py</files>
  <action>
In lifespan() in src/booty/main.py, after configure_logging and before "app_started":

1. Import verifier_enabled from booty.config
2. If not verifier_enabled(settings):
   logger.info("verifier_disabled", reason="missing GITHUB_APP_ID or GITHUB_APP_PRIVATE_KEY")
3. Per CONTEXT: "Explicit log — Verifier: disabled (missing GITHUB_APP_ID or GITHUB_APP_PRIVATE_KEY)"
   Use structlog so the message is visible; include reason in structured log.

Exact log key: "verifier_disabled" with reason="missing GITHUB_APP_ID or GITHUB_APP_PRIVATE_KEY"
</action>
  <verify>
cd /Users/marlinf/Projects/datashaman/booty && python -c "
# Verify main.py has the log call (without env vars, verifier disabled)
import sys
with open('src/booty/main.py') as f:
    c = f.read()
assert 'verifier_disabled' in c or 'verifier_enabled' in c
print('OK: startup log added')
"
  </verify>
  <done>Startup logs verifier_disabled when GITHUB_APP_ID or GITHUB_APP_PRIVATE_KEY empty.</done>
</task>

</tasks>

<verification>
- Settings loads without error when GITHUB_APP_ID and GITHUB_APP_PRIVATE_KEY are unset
- verifier_enabled(settings) returns False when either is empty, True when both set
- On startup, when disabled, log contains verifier_disabled
</verification>

<success_criteria>
- [ ] GITHUB_APP_ID, GITHUB_APP_PRIVATE_KEY in Settings with empty defaults
- [ ] verifier_enabled(settings) helper
- [ ] Startup logs verifier_disabled when credentials missing
</success_criteria>

<output>
After completion, create `.planning/phases/07-github-app-checks/07-01-SUMMARY.md`
</output>
