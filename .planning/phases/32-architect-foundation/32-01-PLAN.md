---
phase: 32-architect-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/booty/architect/config.py
  - src/booty/test_runner/config.py
  - tests/test_architect_config.py
autonomous: true

must_haves:
  truths:
    - .booty.yml loads optional architect block
    - ArchitectConfig validates with extra="forbid"; unknown keys raise ArchitectConfigError at get_architect_config (not at BootyConfig load)
    - apply_architect_env_overrides applies ARCHITECT_ENABLED only
  artifacts:
    - path: src/booty/architect/config.py
      provides: ArchitectConfig, get_architect_config, apply_architect_env_overrides, ArchitectConfigError
    - path: src/booty/test_runner/config.py
      provides: BootyConfigV1.architect field (raw dict)
  key_links:
    - from: BootyConfigV1
      to: architect block
      via: field_validator(mode="before") keeps raw dict
      pattern: architect.*dict
---

<objective>
Add ArchitectConfig and optional architect block to .booty.yml.

Purpose: Repos can configure Architect (enabled, rewrite_ambiguous_steps, enforce_risk_rules). Unknown keys fail Architect only â€” BootyConfig loads; get_architect_config raises ArchitectConfigError when architect block has invalid/unknown keys.
Output: ArchitectConfig, BootyConfigV1.architect (raw dict), get_architect_config, apply_architect_env_overrides.
</objective>

<execution_context>
@/Users/marlinf/.claude/get-shit-done/workflows/execute-plan.md
@/Users/marlinf/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/32-architect-foundation/32-CONTEXT.md
@.planning/phases/32-architect-foundation/32-RESEARCH.md
@src/booty/planner/config.py
@src/booty/test_runner/config.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: ArchitectConfig and BootyConfigV1.architect</name>
  <files>src/booty/architect/config.py, src/booty/test_runner/config.py</files>
  <action>
1. Create src/booty/architect/__init__.py (empty or minimal).

2. Create src/booty/architect/config.py:
   - ArchitectConfig(BaseModel) with model_config = ConfigDict(extra="forbid")
   - Fields: enabled (bool = True), rewrite_ambiguous_steps (bool = True), enforce_risk_rules (bool = True) per CONTEXT and ARCH-31
   - ArchitectConfigError(Exception) - raised when architect block has unknown keys
   - get_architect_config(booty_config) -> ArchitectConfig | None:
     - If booty_config.architect is None or absent: return None
     - If dict: try ArchitectConfig.model_validate(architect); on ValidationError raise ArchitectConfigError (wrap original); on success return ArchitectConfig. Unknown keys fail Architect only.

3. In test_runner/config.py add architect: dict | None = None to BootyConfigV1. field_validator("architect", mode="before"): when dict return v as-is; when None return None. BootyConfig loads with architect as raw dict; no ValidationError at load time.

4. Ensure load_booty_config_from_content handles architect. Backward compat: repos without architect key load with architect=None.
  </action>
  <verify>python -c "
from booty.test_runner.config import load_booty_config_from_content
c = load_booty_config_from_content('schema_version: 1\ntest_command: pytest\narchitect:\n  enabled: true\n  rewrite_ambiguous_steps: true\n  enforce_risk_rules: true')
assert c.architect is not None
assert isinstance(c.architect, dict)
from booty.architect.config import get_architect_config
ac = get_architect_config(c)
assert ac is not None
assert ac.enabled is True
assert ac.rewrite_ambiguous_steps is True
assert ac.enforce_risk_rules is True
c2 = load_booty_config_from_content('schema_version: 1\ntest_command: pytest')
assert c2.architect is None
assert get_architect_config(c2) is None
"</verify>
  <done>BootyConfigV1 loads .booty.yml with optional architect block as raw dict; get_architect_config returns ArchitectConfig or None</done>
</task>

<task type="auto">
  <name>Task 2: apply_architect_env_overrides</name>
  <files>src/booty/architect/config.py</files>
  <action>
Add apply_architect_env_overrides(config: ArchitectConfig) -> ArchitectConfig. Apply env var ARCHITECT_ENABLED only: "1"/"true"/"yes" -> enabled=True; "0"/"false"/"no" -> enabled=False. Return config.model_copy(update=overrides) when overrides present, else return config unchanged. Per CONTEXT: only ARCHITECT_ENABLED as kill switch; no other env overrides for architect block.
  </action>
  <verify>ARCHITECT_ENABLED=false python -c "
from booty.architect.config import ArchitectConfig, apply_architect_env_overrides
c = ArchitectConfig(enabled=True)
c2 = apply_architect_env_overrides(c)
assert c2.enabled is False
"</verify>
  <done>ARCHITECT_ENABLED overrides architect.enabled</done>
</task>

<task type="auto">
  <name>Task 3: ArchitectConfig tests</name>
  <files>tests/test_architect_config.py</files>
  <action>
Add tests: (1) ArchitectConfig defaults (enabled=True, rewrite_ambiguous_steps=True, enforce_risk_rules=True); (2) BootyConfigV1 loads architect block as raw dict; (3) get_architect_config returns ArchitectConfig from valid block; (4) get_architect_config returns None when architect block absent; (5) get_architect_config raises ArchitectConfigError when architect block has unknown key; (6) apply_architect_env_overrides with ARCHITECT_ENABLED=false; (7) apply_architect_env_overrides with no env leaves config unchanged.
  </action>
  <verify>pytest tests/test_architect_config.py -v</verify>
  <done>All architect config tests pass</done>
</task>

</tasks>

<verification>
- pytest tests/test_architect_config.py passes
- Load .booty.yml with architect block via load_booty_config_from_content
- Unknown keys in architect block raise ArchitectConfigError at get_architect_config
</verification>

<success_criteria>
- .booty.yml architect block optional
- ArchitectConfig has enabled, rewrite_ambiguous_steps, enforce_risk_rules
- Unknown keys fail Architect only (ArchitectConfigError at get_architect_config)
- apply_architect_env_overrides works for ARCHITECT_ENABLED
</success_criteria>

<output>
After completion, create .planning/phases/32-architect-foundation/32-01-SUMMARY.md
</output>
