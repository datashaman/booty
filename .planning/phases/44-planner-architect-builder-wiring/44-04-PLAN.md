---
phase: 44-planner-architect-builder-wiring
plan: 04
type: execute
wave: 2
depends_on: ['44-03']
files_modified:
  - docs/routing.md
autonomous: true

must_haves:
  truths:
    - docs/routing.md exists with decision table: event + plan state -> action
    - Config precedence documented: env vs file vs default for architect, builder_compat, planner
    - Disabled-agent behavior: full matrix (Architect off, Planner off, etc.) documented
  artifacts:
    - path: docs/routing.md
      provides: Routing logic documentation
      min_lines: 80
  key_links:
    - from: docs/routing.md
      to: src/booty/router/router.py
      via: Documents _route_issues behavior
      pattern: plan-state|Architect|Planner|Builder
---

<objective>
Document routing logic. WIRE-05: Routing logic is auditable and documented.

Purpose: Operator can debug routing without reading code. Decision table, config precedence, disabled-agent matrix.
Output: docs/routing.md
</objective>

<execution_context>
@/Users/marlinf/.claude/get-shit-done/workflows/execute-plan.md
@/Users/marlinf/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/44-planner-architect-builder-wiring/44-CONTEXT.md
@.planning/phases/44-planner-architect-builder-wiring/44-RESEARCH.md
@src/booty/router/router.py
</context>

<tasks>

<task type="auto">
  <name>Create docs/routing.md</name>
  <files>docs/routing.md</files>
  <action>
Create docs/routing.md with:

1. Overview: Plan-state-first routing for issues.labeled/opened with trigger label. Router resolves plan via get_plan_for_builder, then routes to Planner | Architect | Builder.

2. Decision table (markdown table):
   | Plan state | Architect enabled | Action |
   |------------|-------------------|--------|
   | Architect-approved | yes | Builder |
   | Unreviewed (Planner plan) | yes | Architect |
   | No plan | yes | Planner |
   | Plan exists (any) | no | Builder (Architect skipped) |
   | No plan | no | Planner |

3. Config precedence: env overrides file; file overrides default. Per-flag: ARCHITECT_ENABLED, ARCHITECT_BUILDER_COMPAT, PLANNER_ENABLED. Document each.

4. builder_compat: When true (default), Builder can use Planner plan when no Architect artifact. When false, Builder requires Architect artifact; unreviewed plans route to Architect.

5. Disabled-agent matrix: Architect disabled + plan exists -> Builder (Planner plan). Planner disabled + no plan -> builder_blocked comment, no enqueue. Planner disabled + Architect-approved -> Builder only. Architect disabled + unreviewed -> Builder (compat allows Planner plan).

6. Dedup keys: Planner (repo, delivery_id); Architect (repo, plan_hash); Builder (repo, delivery_id) or (repo, issue_number) for issue-driven.

7. Inline reference: "Implementation: src/booty/router/router.py _route_issues"
</action>
  <verify>test -f docs/routing.md && grep -q "Decision table\|Architect-approved\|builder_compat" docs/routing.md</verify>
  <done>docs/routing.md exists; decision table, config precedence, disabled-agent matrix present</done>
</task>

</tasks>

<verification>
- WIRE-05: Routing logic auditable and documented
- Operator can debug routing without reading code
</verification>

<success_criteria>
- docs/routing.md with decision table, config precedence, disabled-agent behavior
- Reference to router implementation
</success_criteria>

<output>
After completion, create .planning/phases/44-planner-architect-builder-wiring/44-04-SUMMARY.md
</output>
