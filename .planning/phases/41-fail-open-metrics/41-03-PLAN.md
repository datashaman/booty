---
phase: 41-fail-open-metrics
plan: 03
type: execute
wave: 3
depends_on: [41-01, 41-02]
files_modified:
  - src/booty/cli.py
  - docs/capabilities-summary.md
  - docs/reviewer.md
autonomous: true

must_haves:
  truths:
    - booty reviewer status shows enabled and 24h metrics
    - booty reviewer status --json returns machine-readable output
    - reviewer.md documents fail-open semantics, emitted metrics, troubleshooting
  artifacts:
    - path: docs/reviewer.md
      provides: Fail-open semantics, metrics names, troubleshooting
  key_links:
    - from: src/booty/cli.py
      to: booty.reviewer.metrics
      via: get_reviewer_24h_stats for status command
      pattern: get_reviewer_24h_stats
---

<objective>
Add booty reviewer status CLI (--json) reading from persisted metrics, and extend docs: capabilities-summary, reviewer.md with fail-open semantics, emitted metrics, troubleshooting checklist.

Purpose: Operators can inspect Reviewer health; docs explain behavior.
Output: reviewer status command, updated docs.
</objective>

<execution_context>
@/Users/marlinf/.claude/get-shit-done/workflows/execute-plan.md
@/Users/marlinf/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/41-fail-open-metrics/41-CONTEXT.md
@src/booty/cli.py
@docs/architect.md
@docs/reviewer.md
@docs/capabilities-summary.md
</context>

<tasks>

<task type="auto">
  <name>Add booty reviewer status command</name>
  <files>src/booty/cli.py</files>
  <action>
Add reviewer Click group and status command, mirroring architect pattern (cli.py lines 541-581):

1. @cli.group() def reviewer() -> None: """Reviewer (code quality) commands."""

2. @reviewer.command("status")
   @click.option("--repo", ...)
   @click.option("--workspace", type=click.Path(...), default=".")
   @click.option("--json", "as_json", is_flag=True)
   def reviewer_status(repo, workspace, as_json):
     - Infer repo from git if not provided
     - Load booty config, get_reviewer_config, apply_reviewer_env_overrides → enabled
     - stats = get_reviewer_24h_stats() from booty.reviewer.metrics
     - data = {enabled, reviews_total, reviews_blocked, reviews_suggestions, reviewer_fail_open}
     - if as_json: json.dumps(data) else print each k: v
</action>
  <verify>booty reviewer status 2>/dev/null | head -6; booty reviewer status --json 2>/dev/null | python -m json.tool</verify>
  <done>booty reviewer status prints enabled and 24h breakdown; --json works</done>
</task>

<task type="auto">
  <name>Update capabilities-summary and reviewer.md</name>
  <files>docs/capabilities-summary.md, docs/reviewer.md</files>
  <action>
1. capabilities-summary.md: In "Reviewer Agent (v1.9)" section, add one line: "CLI: booty reviewer status. Persisted metrics: reviews_total, reviews_blocked, reviews_suggestions, reviewer_fail_open."

2. reviewer.md: Add sections after "Comment format":
   - **Fail-open** — When diff fetch, GitHub API, LLM, or schema fails: check success with title "Reviewer unavailable (fail-open)", summary "Review did not run; promotion/merge not blocked". No PR comment. Increments reviewer_fail_open. Failure buckets: diff_fetch_failed, github_api_failed, llm_timeout, llm_error, schema_parse_failed, unexpected_exception.
   - **Metrics** — Persisted under ~/.booty/state/reviewer/metrics.json: reviews_total, reviews_blocked, reviews_suggestions, reviewer_fail_open (rolling 24h).
   - **CLI** — booty reviewer status [--repo owner/repo] [--json]
   - **Troubleshooting** — Checklist: token missing (GITHUB_TOKEN), diff fetch (base/head SHA access), LLM timeout (increase or check provider)
</action>
  <verify>grep -c "reviewer_fail_open\|Fail-open\|booty reviewer status" docs/reviewer.md; grep "booty reviewer status" docs/capabilities-summary.md</verify>
  <done>Docs include fail-open semantics, metrics names, CLI, troubleshooting checklist</done>
</task>

</tasks>

<verification>
- booty reviewer status reads from persisted metrics (not logs)
- docs/capabilities-summary mentions Reviewer CLI and metrics
- docs/reviewer.md has fail-open, metrics, CLI, troubleshooting
</verification>

<success_criteria>
- reviewer status command with --json
- capabilities-summary updated
- reviewer.md: fail-open semantics, metrics, CLI, troubleshooting
</success_criteria>

<output>
After completion, create .planning/phases/41-fail-open-metrics/41-03-SUMMARY.md
</output>
