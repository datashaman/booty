---
phase: 20-dependency-vulnerability-gate
plan: 01
subsystem: security
tags: pip-audit, npm-audit, composer, cargo-audit, lockfile

# Dependency graph
requires:
  - phase: 19-secret-leakage-detection
    provides: run_secret_scan, SecurityConfig
provides:
  - discover_lockfiles(workspace_path) -> list[tuple[ecosystem, path]]
  - run_dependency_audit(workspace_path, config) -> AuditResult
  - AuditResult with ok, findings, errors, worst_severity
affects: 20-02 (runner integration)

# Tech tracking
tech-stack:
  added: []
  patterns: ThreadPoolExecutor for parallel audits, subprocess.run with JSON parse

key-files:
  created: [src/booty/security/audit.py, tests/test_security_audit.py]
  modified: []

key-decisions:
  - "pip-audit vulns treated as HIGH (no severity in JSON per RESEARCH)"
  - "Python: one audit per directory, prefer lockfile over manifest"

patterns-established:
  - "Per-ecosystem runners check shutil.which before run; clear error message on missing"
  - "Dedup by content hash for identical lockfiles; Python dedup by dir"

# Metrics
duration: ~15min
completed: 2026-02-16
---

# Phase 20 Plan 01: Dependency Audit Module Summary

**Lockfile discovery and per-ecosystem dependency audit with parallel execution, severity filtering, and AuditResult for runner consumption.**

## Performance

- **Duration:** ~15 min
- **Tasks:** 4
- **Files modified:** 2 created

## Accomplishments

- `discover_lockfiles(Path)` — globs LOCKFILE_PATTERNS (python/node/php/rust), dedupes by content hash, Python dir-dedup
- `AuditResult` dataclass — ok, findings, errors, summary_by_ecosystem, worst_severity
- Per-tool runners: `_run_python_audit`, `_run_node_audit`, `_run_composer_audit`, `_run_cargo_audit`
- `run_dependency_audit` — parallel execution via ThreadPoolExecutor, severity filter from config.fail_severity

## Task Commits

1. **Task 1–3: Lockfile discovery, AuditResult, run_dependency_audit** — `0c65282` (feat)
2. **Task 4: Audit tests** — `02bbc45` (test)

## Files Created/Modified

- `src/booty/security/audit.py` — discover_lockfiles, AuditResult, run_dependency_audit
- `tests/test_security_audit.py` — unit tests for discover_lockfiles, AuditResult, run_dependency_audit

## Decisions Made

- pip-audit JSON vulns lack severity; treat as HIGH when present (RESEARCH)
- Tool not installed → FAIL with clear message per CONTEXT

## Deviations from Plan

None — plan executed exactly as written.

## Issues Encountered

None

## Next Phase Readiness

Ready for 20-02-PLAN.md — runner integration. `run_dependency_audit` and `AuditResult` available.

---
*Phase: 20-dependency-vulnerability-gate*
*Completed: 2026-02-16*
