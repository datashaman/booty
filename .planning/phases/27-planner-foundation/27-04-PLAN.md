---
phase: 27-planner-foundation
plan: 04
type: execute
wave: 2
depends_on: ['01', '02']
files_modified:
  - src/booty/cli.py
autonomous: true

must_haves:
  truths:
    - booty plan --issue &lt;n&gt; exists and produces plan, stores to plans/&lt;owner&gt;/&lt;repo&gt;/&lt;n&gt;.json
    - booty plan --text "..." exists and produces plan, stores to plans/ad-hoc-&lt;ts&gt;-&lt;hash&gt;.json
    - Silent by default; --verbose for progress; --output &lt;path&gt; to write to file
    - On success: print path + one-line summary (goal snippet + step count)
    - On failure: short error on stderr; --verbose for trace
  artifacts:
    - path: src/booty/cli.py
      provides: booty plan group, --issue, --text subcommands
  key_links:
    - from: booty plan --issue
      to: plan_path_for_issue, save_plan
      via: fetch issue from GitHub, build minimal plan
      pattern: plan_path_for_issue|save_plan
    - from: booty plan --text
      to: plan_path_for_ad_hoc, save_plan
      via: build minimal plan from text
      pattern: plan_path_for_ad_hoc|save_plan
---

<objective>
Add booty plan CLI with --issue and --text subcommands.

Purpose: Operator can trigger planner from CLI. Skeleton: minimal plan from issue body/title or text, store to artifact. Silent by default per CONTEXT.
Output: booty plan --issue N, booty plan --text "...".
</objective>

<execution_context>
@/Users/marlinf/.claude/get-shit-done/workflows/execute-plan.md
@/Users/marlinf/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/27-planner-foundation/27-CONTEXT.md
@.planning/phases/27-planner-foundation/27-RESEARCH.md
@src/booty/cli.py
@src/booty/memory/config.py
@src/booty/planner/schema.py
@src/booty/planner/store.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: booty plan group and --issue</name>
  <files>src/booty/cli.py</files>
  <action>
Add @cli.group() def plan(): "Plan generation subcommands"

Add @plan.command() def issue(issue_number: int, repo: str | None, verbose: bool, output: str | None):
- --repo: optional; infer from git remote when in repo, else require.
- --verbose: is_flag
- --output: optional path to write plan JSON (default: store to plans/ and print path)
- Require GITHUB_TOKEN for --issue (fetch issue via PyGithub)
- Infer repo from workspace git remote if --repo not given
- Fetch issue: repo.get_issue(issue_number). Build minimal Plan(goal=issue.title, steps=[], risk_level="LOW", touch_paths=[], handoff_to_builder=HandoffToBuilder(branch_name_hint="plan", commit_message_hint=goal, pr_title=goal, pr_body_outline=""))
- path = plan_path_for_issue(owner, repo_name, issue_number)
- save_plan(plan, path)
- On success: click.echo(path) then one-line summary (e.g. f"{path} | {goal[:50]}... | 0 steps"). If --output given, also write to that path (copy).
- On failure: click.echo("Error: ...", err=True); if --verbose, print trace
  </action>
  <verify>GITHUB_TOKEN=... booty plan --issue 1 --repo owner/repo (with valid issue) stores plan, echoes path</verify>
  <done>booty plan --issue fetches issue, builds minimal plan, stores, prints path + summary</done>
</task>

<task type="auto">
  <name>Task 2: booty plan --text</name>
  <files>src/booty/cli.py</files>
  <action>
Add @plan.command() def text(text: str, verbose: bool, output: str | None):
- Use click.argument("text") or --text for the prompt
- --verbose, --output same as --issue
- Build minimal Plan(goal=text[:200], steps=[], risk_level="LOW", touch_paths=[], handoff_to_builder placeholder)
- path = plan_path_for_ad_hoc(text)
- save_plan(plan, path)
- On success: stdout default (print path); use --output to also write to specified file. One-line summary.
- On failure: stderr, --verbose for trace
  </action>
  <verify>booty plan --text "Add login page" stores to plans/ad-hoc-*.json, echoes path</verify>
  <done>booty plan --text builds minimal plan, stores to ad-hoc path, prints path + summary</done>
</task>

</tasks>

<verification>
- booty plan --issue 1 --repo owner/repo produces plans/owner/repo/1.json
- booty plan --text "foo" produces plans/ad-hoc-*.json
- --output writes to specified path
- Silent by default; --verbose shows more
</verification>

<success_criteria>
- booty plan --issue &lt;n&gt; and booty plan --text "..." exist
- Plans stored to correct paths
- Success: path + one-line summary
- Failure: stderr, --verbose for trace
</success_criteria>

<output>
After completion, create .planning/phases/27-planner-foundation/27-04-SUMMARY.md
</output>
