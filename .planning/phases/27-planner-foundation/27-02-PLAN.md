---
phase: 27-planner-foundation
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/booty/planner/config.py
  - src/booty/test_runner/config.py
  - tests/test_planner_config.py
autonomous: true

must_haves:
  truths:
    - .booty.yml loads optional planner block
    - PlannerConfig validates with extra="forbid"
    - apply_planner_env_overrides applies PLANNER_* env vars
  artifacts:
    - path: src/booty/planner/config.py
      provides: PlannerConfig, get_planner_config, apply_planner_env_overrides
    - path: src/booty/test_runner/config.py
      provides: BootyConfigV1.planner field
  key_links:
    - from: BootyConfigV1
      to: planner block
      via: field_validator(mode="before")
      pattern: planner.*PlannerConfig
---

<objective>
Add optional planner block to .booty.yml with env overrides.

Purpose: Repos can configure planner; PLANNER_* env vars override. Mirrors Memory/Security config pattern.
Output: PlannerConfig, BootyConfigV1.planner, apply_planner_env_overrides.
</objective>

<execution_context>
@/Users/marlinf/.claude/get-shit-done/workflows/execute-plan.md
@/Users/marlinf/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/27-planner-foundation/27-CONTEXT.md
@.planning/phases/27-planner-foundation/27-RESEARCH.md
@src/booty/memory/config.py
@src/booty/test_runner/config.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: PlannerConfig and BootyConfigV1.planner</name>
  <files>src/booty/planner/config.py, src/booty/test_runner/config.py</files>
  <action>
1. Create src/booty/planner/config.py. Define PlannerConfig(BaseModel) with model_config = ConfigDict(extra="forbid"). Fields: enabled (bool = True). Minimal for Phase 27 â€” env overrides only per CONTEXT.

2. Add get_planner_config(booty_config) -> PlannerConfig | None. When booty_config.planner is None or invalid, return None.

3. In test_runner/config.py add planner: PlannerConfig | None = None to BootyConfigV1. Use field_validator("planner", mode="before"): when value is dict, try PlannerConfig.model_validate(v); on ValidationError return None. When None or absent, return None. Mirror validate_security_block.

4. Ensure _parse_booty_config and load_booty_config_from_content handle planner. Backward compat: repos without planner key load with planner=None.
  </action>
  <verify>python -c "
from booty.test_runner.config import load_booty_config_from_content
c = load_booty_config_from_content('schema_version: 1\ntest_command: pytest\nplanner:\n  enabled: true')
assert c.planner is not None
assert c.planner.enabled is True
c2 = load_booty_config_from_content('schema_version: 1\ntest_command: pytest')
assert c2.planner is None
"</verify>
  <done>BootyConfigV1 loads .booty.yml with optional planner block; invalid block sets planner=None</done>
</task>

<task type="auto">
  <name>Task 2: apply_planner_env_overrides</name>
  <files>src/booty/planner/config.py</files>
  <action>
Add apply_planner_env_overrides(config: PlannerConfig) -> PlannerConfig. Apply env vars:
- PLANNER_ENABLED: "1"/"true"/"yes" -> enabled=True; "0"/"false"/"no" -> enabled=False

Return config.model_copy(update=overrides) when overrides present, else return config unchanged. Mirror apply_memory_env_overrides pattern.
  </action>
  <verify>PLANNER_ENABLED=false python -c "
from booty.planner.config import PlannerConfig, apply_planner_env_overrides
c = PlannerConfig(enabled=True)
c2 = apply_planner_env_overrides(c)
assert c2.enabled is False
"</verify>
  <done>PLANNER_ENABLED overrides planner.enabled</done>
</task>

<task type="auto">
  <name>Task 3: PlannerConfig tests</name>
  <files>tests/test_planner_config.py</files>
  <action>
Add tests: (1) PlannerConfig default enabled=True; (2) BootyConfigV1 loads planner block; (3) Invalid planner block sets planner=None; (4) apply_planner_env_overrides with PLANNER_ENABLED=false; (5) apply_planner_env_overrides with no env leaves config unchanged.
  </action>
  <verify>pytest tests/test_planner_config.py -v</verify>
  <done>All planner config tests pass</done>
</task>

</tasks>

<verification>
- pytest tests/test_planner_config.py passes
- Load .booty.yml with planner block via load_booty_config_from_content
</verification>

<success_criteria>
- .booty.yml planner block optional
- PlannerConfig validates; invalid block does not fail config load
- apply_planner_env_overrides works for PLANNER_ENABLED
</success_criteria>

<output>
After completion, create .planning/phases/27-planner-foundation/27-02-SUMMARY.md
</output>
