# Milestone v1.9: Reviewer Agent

**Status:** In progress
**Phases:** 37–41

## Overview

Reviewer Agent performs AI-driven code review on Builder-generated PRs before promotion for human review. It evaluates engineering quality (maintainability, overengineering, duplication, test quality, naming, architectural drift) — not correctness, lint, or security. Sits between Builder and Verifier.

Flow: Planner → Architect → Builder → **Reviewer** → Verifier → Security → Governor → Deploy

## Phases

### Phase 37: Skeleton + Check Plumbing

**Goal:** Reviewer module skeleton, config schema, check run lifecycle, single comment upsert.

**Depends on:** v1.8 (Phase 36)

**Requirements:** REV-04, REV-10, REV-12, REV-13

**Success criteria:**
1. `src/booty/reviewer/` module skeleton
2. ReviewerConfig schema, env overrides, unknown-key isolation (fail Reviewer only)
3. Check run creation/update for queued → in_progress → success/failure
4. Single PR comment upsert with `<!-- booty-reviewer -->` marker

---

### Phase 38: Agent PR Detection + Event Wiring

**Goal:** pull_request webhook integration, dedup/cancel behavior, agent PR filtering.

**Depends on:** Phase 37

**Requirements:** REV-01, REV-02, REV-03, REV-05

**Success criteria:**
1. Hook into pull_request webhook for opened/synchronize (optionally reopened)
2. Dedup key (repo, pr_number, head_sha); new SHA cancels prior in-progress (best-effort)
3. Only run for agent PRs (same detection as Verifier)
4. Check titles: Queued/In progress "Booty Reviewer"; Success "Reviewer approved" or "Reviewer approved with suggestions"; Failure "Reviewer blocked"

---

### Phase 39: Review Engine (LLM Prompt + Rubric)

**Goal:** Diff-focused LLM prompt, output schema, block_on config mapping.

**Depends on:** Phase 38

**Requirements:** REV-06, REV-07, REV-08, REV-11

**Success criteria:**
1. Prompt: quality only, no lint/tests reruns
2. Output schema: decision (APPROVED/APPROVED_WITH_SUGGESTIONS/BLOCKED) + categories + bullets + referenced paths
3. Map block_on config to evaluation categories (overengineering, poor_tests, duplication, architectural_regression)
4. Evaluate: maintainability, overengineering, duplication, test quality, naming/API, architectural regression

---

### Phase 40: Promotion Gating

**Goal:** Builder promotion requires Reviewer success for agent PRs.

**Depends on:** Phase 39

**Requirements:** REV-14

**Success criteria:**
1. Builder promotion logic: agent PR requires booty/reviewer success AND booty/verifier success
2. Fail-open success counts as success
3. Non-agent PRs unaffected

---

### Phase 41: Fail-Open + Metrics

**Goal:** Harden failure handling, emit metrics and structured logs, minimal docs.

**Depends on:** Phase 40

**Requirements:** REV-09, REV-15

**Success criteria:**
1. Infra/LLM failure → check success with "Reviewer unavailable (fail-open)", increment reviewer_fail_open
2. Metrics: reviews_total, reviews_blocked, reviews_suggestions, reviewer_fail_open
3. Structured logs: repo, pr, sha, outcome, blocked_categories, suggestion_count
4. Docs section in capabilities-summary, reviewer.md

---

## Milestone Summary

**Key Decisions:**
- Reviewer disabled by default when block missing (no surprising required checks on existing repos)
- Fail-open: quality tooling never halts delivery due to infra issues
- REVIEWER_ENABLED env wins over file config
- Unknown reviewer keys fail Reviewer only

**Scope Rules:**
- No re-running tests/lint/security
- No formatting/style nitpicks
- Reviewer only affects promotion; Verifier remains merge gate

---
*Created: 2026-02-17*
