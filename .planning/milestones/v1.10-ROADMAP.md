# Milestone v1.10: Pipeline Correctness

**Status:** ✅ SHIPPED 2026-02-17
**Phases:** 42–47
**Total Plans:** 16

## Overview

Given any relevant GitHub event, Booty runs exactly the right agents exactly once, promotes correctly, and never stalls silently. Focus: event router, Planner→Architect→Builder wiring, promotion gating, dedup/cancel alignment, operator visibility.

## Phases

### Phase 42: Event Router

**Goal:** Single canonical event router; normalize GitHub events to internal events; should_run decision point.

**Depends on:** v1.9 (Phase 41)

**Plans:** 3 plans

Plans:

- [x] 42-01: Internal event structs + normalizer (IssueEvent, PREvent, WorkflowRunEvent)
- [x] 42-02: should_run(agent, repo, context) single decision point
- [x] 42-03: Router module + webhook integration

**Details:** Extracted router package with events.py, normalizer.py, should_run.py, router.py. Webhook delegates issues, pull_request, workflow_run to route_github_event. ROUTE-01 through ROUTE-05 complete.

---

### Phase 43: Dedup Alignment

**Goal:** Standardize dedup keys; add repo to Verifier/Security queues.

**Depends on:** Phase 42

**Plans:** 2 plans

Plans:

- [x] 43-01: VerifierQueue + SecurityQueue repo-scoped dedup + router
- [x] 43-02: Dedup keys documentation

**Details:** All PR agents use (repo_full_name, pr_number, head_sha). Issue agent dedup keys documented in capabilities-summary. DEDUP-01, DEDUP-02, DEDUP-04 complete.

---

### Phase 44: Planner→Architect→Builder Wiring

**Goal:** Audit and fix routing logic; Builder consumes Architect first; compat flag.

**Depends on:** Phase 43

**Plans:** 4 plans

Plans:

- [x] 44-01: Architect standalone enqueue (ArchitectJob, architect_queue, architect worker)
- [x] 44-02: Compat flag (ArchitectConfig.builder_compat, get_plan_for_builder)
- [x] 44-03: Router plan-state-first + Architect enqueue
- [x] 44-04: docs/routing.md

**Details:** Plan-state-first _route_issues: Architect-approved → Builder; unreviewed → Architect; no plan → Planner. Builder consumes Architect artifact first; Planner fallback only when builder_compat enabled. docs/routing.md documents decision table, config precedence, disabled-agent matrix. WIRE-01 through WIRE-05 complete.

---

### Phase 45: Promotion Gate Hardening

**Goal:** Architect check for plan PRs; idempotent promote; deterministic second-finisher.

**Depends on:** Phase 44

**Plans:** 2 plans

Plans:

- [x] 45-01: Idempotent promote_to_ready_for_review
- [x] 45-02: Architect gate + promotion_gates + Verifier wiring

**Details:** promote_to_ready_for_review re-fetches PR draft state for idempotency. promotion_gates.py with is_plan_originated_pr, architect_approved_for_issue. Verifier wires Architect gate after Reviewer. PROMO-01 through PROMO-05 complete.

---

### Phase 46: Cancel Semantics

**Goal:** Verifier cooperative cancel; new head_sha supersedes prior run.

**Depends on:** Phase 45

**Plans:** 2 plans

Plans:

- [x] 46-01: VerifierQueue request_cancel + VerifierJob cancel_event
- [x] 46-02: Verifier runner cancel checks at phase boundaries

**Details:** VerifierQueue.request_cancel mirrors ReviewerQueue; VerifierJob.cancel_event; runner checks at ~14 phase boundaries; superseded run exits with conclusion=cancelled. DEDUP-03, DEDUP-05 complete.

---

### Phase 47: Operator Visibility

**Goal:** Structured skip logs; booty status CLI.

**Depends on:** Phase 46

**Plans:** 3 plans

Plans:

- [x] 47-01: Structured skip logs (skip_reasons, router)
- [x] 47-02: booty status CLI (last_run, workers, cli)
- [x] 47-03: OPS-04 verify + document

**Details:** skip_reasons.py five-bucket vocabulary; _log_event_skip for all skip paths. operator/last_run.py with record_agent_completed; booty status shows six agents, last_run_completed_at. promotion_waiting_reviewer documented. OPS-01 through OPS-04 complete.

---

## Milestone Summary

**Decimal Phases:** None

**Key Decisions:**

- Plan-state-first routing (no Planner-first branch); resolve plan via get_plan_for_builder before enqueue
- builder_compat defaults True for safe migration; Architect disabled → Builder uses Planner plan directly
- Verifier is sole caller of promote_to_ready_for_review (grep-verified)
- record_agent_completed in queue workers (not runners) — ensures recording on all exit paths

**Issues Resolved:**

- Canonical event router eliminates scattered enqueue logic
- PR agent dedup aligned: (repo_full_name, pr_number, head_sha) for multi-repo correctness
- Architect gate blocks promotion for plan-originated PRs when Architect enabled and not approved
- New head_sha supersedes prior Verifier run; cooperative cancel at phase boundaries

**Issues Deferred:**

- OPS-05: Persistent queue metrics (requires queue instrumentation)
- DEDUP-06: Security cooperative cancel (optional; Security runs fast)
- ROUTE-06: Subscription-based routing (agents register for events)

**Technical Debt Incurred:**

None recorded for v1.10. Deferred items documented in REQUIREMENTS archive.

---

_For current project status, see .planning/ROADMAP.md_

---
*Archived: 2026-02-17 as part of v1.10 milestone completion*
