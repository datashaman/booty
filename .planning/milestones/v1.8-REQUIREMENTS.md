# Requirements Archive: v1.8 Architect Agent

**Archived:** 2026-02-17
**Status:** ✅ SHIPPED

This is the archived requirements specification for v1.8.
For current requirements, see `.planning/REQUIREMENTS.md` (created for next milestone via `/gsd:new-milestone`).

---

# Requirements: Booty v1.8 Architect Agent

**Defined:** 2026-02-17
**Core Value:** A Builder agent that can take a GitHub issue and produce a working PR with tested code.

## v1.8 Requirements

Requirements for Architect Agent milestone. Each maps to roadmap phases.

### Position & Triggering

- [x] **ARCH-01**: Architect runs only after Planner successfully generates a plan (subscribes to Planner completion, not GitHub labels)
- [x] **ARCH-02**: Architect triggers when Planner posts/updates plan comment (issues.opened agent:plan, issues.labeled agent:plan, booty plan CLI)
- [x] **ARCH-03**: Architect never runs directly from GitHub labels; only from Planner completion event

### Inputs

- [x] **ARCH-04**: Architect receives plan_json, normalized_input, optional repo_context, optional issue_metadata
- [x] **ARCH-05**: Architect must operate when repo_context is missing

### Validation — Structural Integrity

- [x] **ARCH-06**: Architect validates steps ≤ 12
- [x] **ARCH-07**: Architect validates each step has id + action
- [x] **ARCH-08**: Architect validates actions ∈ {read, add, edit, run, verify, research}

### Validation — Path Consistency

- [x] **ARCH-09**: Architect validates touch_paths == union(step.paths)
- [x] **ARCH-10**: Architect flags empty paths unless justified

### Validation — Risk Accuracy

- [x] **ARCH-11**: Architect recomputes risk from touch_paths (HIGH: .github/workflows/, infra/, migrations, lockfiles; MEDIUM: manifests; else LOW)
- [x] **ARCH-12**: Architect overrides Planner risk when it differs from recomputed value

### Validation — Ambiguity & Overreach

- [x] **ARCH-13**: Architect rewrites steps when instructions are vague (configurable: rewrite_ambiguous_steps)
- [x] **ARCH-14**: Architect detects overreach (repo-wide refactors, multi-domain rewrites, speculative arch changes)
- [x] **ARCH-15**: Architect rewrites into smaller scope when possible

### Output

- [x] **ARCH-16**: Architect produces ArchitectPlan (plan_version, goal, steps, touch_paths, risk_level, handoff_to_builder, architect_notes)
- [x] **ARCH-17**: architect_notes is optional and not consumed by Builder
- [x] **ARCH-18**: Architect updates existing plan comment with <!-- booty-architect --> section (Approved or Rewritten)

### Failure Handling

- [x] **ARCH-19**: When plan cannot be safely rewritten, Architect posts "Architect review required — plan is structurally unsafe."
- [x] **ARCH-20**: Architect applies agent:architect-review label on block
- [x] **ARCH-21**: Architect does NOT trigger Builder when blocked
- [x] **ARCH-22**: No automatic retries on block

### Idempotency

- [x] **ARCH-23**: Architect hashes plan_hash = sha256(plan_json)
- [x] **ARCH-24**: Same plan approved within 24h reuses ArchitectPlan, no rewrite
- [x] **ARCH-25**: Architect updates comment only if changed on cache hit

### Builder Handoff

- [x] **ARCH-26**: Architect persists approved artifact to ~/.booty/state/plans/<repo>/<issue>-architect.json
- [x] **ARCH-27**: Architect emits planner.plan.approved (internal event) when approved — *implementation uses architect.plan.approved for clarity*
- [x] **ARCH-28**: Builder listens for planner.plan.approved (or equivalent handoff) — Builder no longer triggers from agent:builder

### CLI

- [x] **ARCH-29**: booty architect status shows enabled, plans reviewed (24h), rewrites count
- [x] **ARCH-30**: booty architect review --issue N forces re-evaluation

### Configuration

- [x] **ARCH-31**: .booty.yml architect block (enabled, rewrite_ambiguous_steps, enforce_risk_rules)
- [x] **ARCH-32**: enabled defaults to true; unknown keys fail Architect only

### Observability

- [x] **ARCH-33**: Architect emits metrics: plans_reviewed, plans_rewritten, architect_blocks, cache_hits

### Performance

- [x] **ARCH-34**: Architect target runtime < 5 seconds

## Traceability

| Requirement | Phase | Status |
|-------------|-------|--------|
| ARCH-01 | 32 | Complete |
| ARCH-02 | 32 | Complete |
| ARCH-03 | 32 | Complete |
| ARCH-04 | 32 | Complete |
| ARCH-05 | 32 | Complete |
| ARCH-06 | 33 | Complete |
| ARCH-07 | 33 | Complete |
| ARCH-08 | 33 | Complete |
| ARCH-09 | 33 | Complete |
| ARCH-10 | 33 | Complete |
| ARCH-11 | 33 | Complete |
| ARCH-12 | 33 | Complete |
| ARCH-13 | 33 | Complete |
| ARCH-14 | 33 | Complete |
| ARCH-15 | 33 | Complete |
| ARCH-16 | 34 | Complete |
| ARCH-17 | 34 | Complete |
| ARCH-18 | 34 | Complete |
| ARCH-19 | 34 | Complete |
| ARCH-20 | 34 | Complete |
| ARCH-21 | 34 | Complete |
| ARCH-22 | 34 | Complete |
| ARCH-23 | 35 | Complete |
| ARCH-24 | 35 | Complete |
| ARCH-25 | 35 | Complete |
| ARCH-26 | 36 | Complete |
| ARCH-27 | 36 | Complete |
| ARCH-28 | 36 | Complete |
| ARCH-29 | 36 | Complete |
| ARCH-30 | 36 | Complete |
| ARCH-31 | 32 | Complete |
| ARCH-32 | 32 | Complete |
| ARCH-33 | 36 | Complete |
| ARCH-34 | 33 | Complete |

---

## Milestone Summary

**Shipped:** 34 of 34 v1.8 requirements
**Adjusted:** ARCH-27 — implementation uses architect.plan.approved instead of planner.plan.approved (non-blocking)
**Dropped:** None

---
*Archived: 2026-02-17 as part of v1.8 milestone completion*
